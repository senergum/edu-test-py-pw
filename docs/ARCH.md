# Варианты архитектуры проекта авто-тестов
* Рассматриваются варианты архитектур Page Object Model (далее просто POM) стандарта

## Архитектура POM классическая
* Самый распространённый формат директорий
* Строгое разделение POM моделей от локаторов и данных
<details><summary>==[НАЖМИ]== Структура директорий</summary><p>

```
/test-project                       # корневая папка (или основная папка репозитория) проекта авто-тестов
    /page                               # page object модели
        __init__.py
        base_page.py                        # базовый класс (основные методы работы со страницей)
        module_page.py                      # класс модуля
    /resources                          # тестовые данные и локаторы
        __init__.py
        /locators                           # селекторы и элементы
            __init__.py
            module_locators.py                  # селекторы элементов модулей
        /data                               # тестовые данные
            __init__.py
            module_data.py                      # тестовые данные модуля
    /test                               # тестовые сценарии с группировкой по видам
        __init__.py
        /smoke                              # дымы
            test_module.py
        /accept                             # приемка
            test_module.py
        /api                                # апи \ бэк
            test_module_api.py
        /load                               # нагрузочное
            locust_smoke.py
    /config                             # конфигурации
        __init__.py                         
        logger.py                           # конфигурация логирования
        /drivers                            # веб-драйвера и портативные браузеры
        /utils                              # вспомогательные инструменты
            __init__.py
            actions.py                          # сложные методы и действия на страницах
            asserts.py                          # проверки
            helpers.py                          # вспомогательные элементы
    /reports                            # отчетность
        /screenshots                        # скриншоты
        /allure-results                     # аллюр отчеты
        /pytest-html                        # pytest отчеты
        /locust                             # locust отчеты
    /docs                               # документация
        PLAN.md                             # документация проекта, план автоматизации, тест-кейсы и история изменений
        ARCH.md                             # описание архитектуры проекта
        CODE.md                             # описание стиля кода в проекте
    conftest.py                         # фикстуры pytest
    pytest.ini                          # конфигурация тестов
    requirements.txt                    # зависимости
    README.md                           # описание проекта
    .gitignore                          # игнор лист git
```
</p></details>

## Архитектура POM удобная
* Удобный формат директорий объединяющей все ресурсы page object модели модуля в одном месте

<details><summary>==[НАЖМИ]== Структура директорий</summary><p>

```
/test-projectname/                  # корневой каталог (репозиторий) проекта авто-тестов
├── /page/                          # page object модели
│   ├── __init__.py
│   ├── /module_1_page/             # папка с page object моделью и данными модуля 1
│   │   ├── __init__.py
│   │   ├── module_1_page.py        # page object класс модуля 1
│   │   ├── module_1_locators.py    # селекторы элементов модул 2
│   │   └── module_1_data.py        # тестовые данные модуля 2 
│   ├── /module_2_page/             # папка с page object моделью и данными модуля 2
│   │   ├── __init__.py
│   │   ├── module_2_page.py        # page object класс модуля 2
│   │   ├── module_2_locators.py    # селекторы элементов модуля 2
│   │   └── module_2_data.py        # тестовые данные модуля 2
│   └── base_page.py                # базовый page object класс (основные методы работы со страницей)
├── /test/                          # тестовые сценарии с группировкой по видам
│   ├── __init__.py
│   ├── /smoke/                     # дымы (фронт)
│   │   └── test_module.py
│   ├── /accept/                    # приемка (фронт)
│   │   └── test_module.py
│   ├── /api/                       # апи (бэк)
│   │   └── test_module_api.py
│   ├── /load/                      # нагрузочное (locust)
│   └────── locust_smoke.py
├── /config/                        
│   ├── /drivers/                   # веб-драйвера и портативные браузеры
│   ├── /api/                       
│   │   ├── api_client.py           # базовый клиент для API-запросов
│   │   └── auth.py                 # методы аутентификации
│   ├── /cicd/                       
│   │   ├── jenkins.py              # интеграция с CI/CD
│   │   └── telegram.py             # уведомления в Telegram
│   ├── /env/                       
│   │   └── prod.yaml               # yaml настройки для окружения
│   ├── /utils/                     
│   │   ├── actions.py              # действия
│   │   ├── asserts.py              # проверки
│   │   ├── helpers.py              # вспомогательные методы
│   │   ├── reporter.py             # утилита для отчётов allure
│   │   ├── db_connector.py         # подключение к БД
│   │   ├── file_utils.py           # работа с файлами (CSV, Excel, JSON)
│   │   ├── mock_generator.py       # генерация тестовых данных
│   │   └── __init__.py
│   ├── logger.py                   # конфигурация логирования
│   └── __init__.py
├── /report/                        # отчеты и артефакты (если не подключено хранение в jenkins)
│   ├── /screenshots/               # скриншоты
│   ├── /allure-results/            # allure отчеты
│   ├── /pytest-html/               # pytest отчеты
│   ├── /locust/                    # locust отчеты нагрузочного
│   └── /logs/                      # логи выполнения тестов
├── /docs/                          # документация
│   ├── PLAN.md                     # документация проекта, план автоматизации, тест-кейсы и история изменений
│   ├── ARCH.md                     # описание архитектуры проекта
│   └── CODE.md                     # описание стиля кода в проекте
├── conftest.py                     # фикстуры pytest
├── pytest.ini                      # конфигурация тестов
├── requirements.txt                # зависимости
├── README.md                       # описание проекта
└── .gitignore                      # игнор лист git
```
</p></details>

## Архитектура POM для нескольких проектов
* Проект содержится в отдельной папке test-projectname
* Есть возможность хранить несколько относительно независимых проектов в одной директории
<details><summary>==[НАЖМИ]== Структура директорий</summary><p>

```
/test-project                       # корневая папка (или основная папка репозитория) проекта авто-тестов
    /test-projectname                   # папка проекта авто-тестов приложения
        /page                               # page object модели
            __init__.py
            base_page.py                        # базовый класс (основные методы работы со страницей)
            module_page.py                      # класс модуля
        /resources                          # тестовые данные и локаторы
            __init__.py
            /locators                           # селекторы и элементы
                __init__.py
                module_locators.py                  # селекторы элементов модулей
            /data                               # тестовые данные
                __init__.py
                module_data.py                      # тестовые данные модуля
        /test                               # тестовые сценарии с группировкой по видам
            __init__.py
            /smoke                              # дымы
                test_module.py
            /accept                             # приемка
                test_module.py
            /api                                # апи \ бэк
                test_module_api.py
            /load                               # нагрузочное
                locust_smoke.py
        /reports                            # отчетность
            /screenshots                        # скриншоты
            /allure-results                     # аллюр отчеты
            /pytest-html                        # pytest отчеты
            /locust                             # locust отчеты
    /config                                 # конфигурации
        __init__.py                         
        logger.py                               # конфигурация логирования
        /drivers                                # веб-драйвера и портативные браузеры
        /utils                                  # вспомогательные инструменты
            __init__.py
            actions.py                              # сложные методы и действия на страницах
            asserts.py                              # проверки
            helpers.py                              # вспомогательные элементы
    /docs                                   # документация
        PLAN.md                             # документация проекта, план автоматизации, тест-кейсы и история изменений
        ARCH.md                             # описание архитектуры проекта
        CODE.md                             # описание стиля кода в проекте  
    conftest.py                             # фикстуры pytest
    pytest.ini                              # конфигурация тестов
    requirements.txt                        # зависимости
    README.md                               # описание проекта
    .gitignore                              # игнор лист git
```
</p></details>

## Различные варианты организации архитектур тестов под разные задачи
### Моно-архитектура
```
/test-project
├── base_page.py
├── login_page.py
├── login_locators.py
├── login_data.py
├── test_login.py
├── conftest.py
└── ...
```
* Имеет flat структуру (плоскую, одно-уровневую) для Minimum Viable Product (MVP), Proof of Concept (PoC), тестирования, обучения
* Проект на ранней стадии, 1–2 модуля.
* Когда нет смысла тратить время на структуру — важно проверить гипотезу.

### Гибридная архитектура Semi-modular POM
```
/test-project
├── /pages                          # только Page Object классы
│   ├── base_page.py
│   ├── module1_page.py
│   └── module2_page.py
├── /locators                       # все локаторы отдельно
│   ├── module1_locators.py
│   └── module2_locators.py
├── /data                           # тестовые данные
│   ├── module1_data.py
│   └── module2_data.py
├── /tests                          # тесты
│   ├── /smoke/
│   ├── /accept/
│   └── ...
├── /common                         # утилиты, логгеры, ассисты и т.д.
│   ├── actions.py
│   ├── asserts.py
│   └── ...
└── conftest.py
```
* Команде нужно сохранить читаемость POM при ре-использовании кода между модулями.
* Количество модулей небольшое, но требуется изоляция логики.

### Domain-Driven Testing Architecture (DDD-influenced)
```
/test-project
├── /domain
│   ├── /cart
│   │   ├── page.py
│   │   ├── locators.py
│   │   ├── data.py
│   │   └── actions.py
│   ├── /checkout
│   │   └── ...
├── /tests
│   ├── /accept
│   └── /smoke
├── /core                          # инфраструктура: драйверы, утилиты
│   ├── base_page.py
│   ├── asserts.py
│   └── ...
└── conftest.py
```
* Если команда использует DDD-подход в разработке.
* Проект сложный, бизнес-логики много, нужно думать в терминах бизнес-модулей (а не технических страниц).

### Что можно сделать
#### CI/CD
* Добавить папку /ci для скриптов запуска, конфигураций GitLab CI, Jenkins, GitHub Actions:
```
/ci
├── gitlab-ci.yml
├── jenkinsfile
└── run_tests.sh
```
#### Профили
* env/ или settings/ для многоконтурных запусков. Разные профили запуска (dev/stage/prod):
```
/config
├── env_dev.py
├── env_stage.py
└── env_prod.py
```
#### Запуск
* Интерфейс запуска тестов через CLI (например, click или typer)
* Добавь файл runtests.py или cli.py, через который можно удобно запускать тесты, получать отчёты и т.п.
#### Шаблоны/примеры
* Добавь в проект шаблоны написания тестов
```
/examples
└── example_test.py
```

### 🔴 ТО ДЕЛАТЬ НЕ НАДО
* Смешивать слои
  * ❌ Хранить тесты, POM, локаторы, данные и утилиты в одном модуле или папке (например, всё в test/ или utils/).
  * ❌ Размещать логику работы со страницей и тестовую логику в одном классе.
* Игнорировать базовые шаблоны
  * ❌ Отсутствие base_page.py, что ведёт к дублированию кода и сложной поддержке.
  * ❌ Отсутствие общих утилит для часто повторяющихся действий (например, переключения фреймов, ожиданий).
* Жёстко хардкодить
  * ❌ Хардкодить данные в тестах (особенно логины, пароли, данные карт).
  * ❌ Использовать time.sleep() вместо explicit wait.
  * ❌ Жестко прописывать URL-адреса в каждом тесте.
* Переиспользовать utils как свалку
  * ❌ Создавать "мусорную" папку utils, где хранятся и элементы UI, и фреймворки, и базовые действия, и общие переменные.
  * ❌ Хранить POM-классы или локаторы в utils.
* Делать тесную связку тестов и POM
  * ❌ Сильно завязывать тесты на структуру или логику POM, без возможности подмены или моков.
  * ❌ Не использовать абстракцию при работе со страницами.
* Повторять код между модулями
  * ❌ Дублировать одинаковые локаторы, данные или методы в разных POM-классах.
  * ❌ Не выносить общие компоненты (например, header, footer, модальные окна) в отдельные component POM.
* Игнорировать структуру отчетности
  * ❌ Не сохранять скриншоты при падении.
  * ❌ Не использовать интеграцию с Allure или хотя бы pytest-html.
  * ❌ Логирование только через print().
* Не использовать фикстуры или использовать их неправильно
  * ❌ Хардкодить browser = sync_playwright().start().chromium.launch() в каждом тесте.
  * ❌ Использовать глобальные переменные вместо фикстур pytest.
* Ограничиваться только UI тестами
  * ❌ Игнорировать API, когда есть возможность оптимизировать сценарий или ускорить сетап.
  * ❌ Проверять данные только через UI, когда быстрее и стабильнее через API или БД.
* Нарушать читаемость и поддержку
  * ❌ Длинные тестовые функции без описания шагов (без steps, assert, comments).
  * ❌ Отсутствие структуры и иерархии в папках, особенно при росте проекта.
  * ❌ Использовать нестандартные имена файлов и классов (page1, actions2, test1) — усложняет навигацию.

### Общая для всех архитектур схема взаимодействия модулей тестов
```md
          +-------------+
          | module_1.py |<----> locators, data
          +-------------+
                 |
                 v
           +------------+         +---------+
           | base_page  | <-----> | actions |
           +------------+         +---------+
                 |
                 v
         +---------------+
         |   test_*.py   |
         +---------------+
```